(function(){var t={}.hasOwnProperty,n=function(n,i){function u(){this.constructor=n}for(var r in i)t.call(i,r)&&(n[r]=i[r]);return u.prototype=i.prototype,n.prototype=new u,n.__super__=i.prototype,n};ContentTools.ToolShelf=function(){function n(){}return n._tools={},n.stow=function(n,t){return this._tools[t]=n},n.fetch=function(n){if(!this._tools[n])throw new Error("`"+n+"` has not been stowed on the tool shelf");return this._tools[n]},n}();ContentTools.Tool=function(){function n(){}return n.label="Tool",n.icon="tool",n.requiresElement=!0,n.canApply=function(){return!1},n.isApplied=function(){return!1},n.apply=function(){throw new Error("Not implemented");},n.editor=function(){return ContentTools.EditorApp.get()},n.dispatchEditorEvent=function(n,t){return this.editor().dispatchEvent(this.editor().createEvent(n,t))},n._insertAt=function(n){var i,t;return t=n,t.parent().type()!=="Region"&&(t=n.closest(function(n){return n.parent().type()==="Region"})),i=t.parent().children.indexOf(t)+1,[t,i]},n}();ContentTools.Tools.Bold=function(t){function i(){return i.__super__.constructor.apply(this,arguments)}return n(i,t),ContentTools.ToolShelf.stow(i,"bold"),i.label="Bold",i.icon="bold",i.tagName="b",i.canApply=function(n,t){return n.content?t&&!t.isCollapsed():!1},i.isApplied=function(n,t){var r,i,u;return n.content===void 0||!n.content.length()?!1:(u=t.get(),r=u[0],i=u[1],r===i&&(i+=1),n.content.slice(r,i).hasTags(this.tagName,!0))},i.apply=function(n,t,i){var r,u,f,e;if(f={tool:this,element:n,selection:t},this.dispatchEditorEvent("tool-apply",f))return n.storeState(),e=t.get(),r=e[0],u=e[1],n.content=this.isApplied(n,t)?n.content.unformat(r,u,new HTMLString.Tag(this.tagName)):n.content.format(r,u,new HTMLString.Tag(this.tagName)),n.content.optimize(),n.updateInnerHTML(),n.taint(),n.restoreState(),i(!0),this.dispatchEditorEvent("tool-applied",f)},i}(ContentTools.Tool);ContentTools.Tools.Italic=function(t){function i(){return i.__super__.constructor.apply(this,arguments)}return n(i,t),ContentTools.ToolShelf.stow(i,"italic"),i.label="Italic",i.icon="italic",i.tagName="i",i}(ContentTools.Tools.Bold);ContentTools.Tools.Link=function(t){function i(){return i.__super__.constructor.apply(this,arguments)}return n(i,t),ContentTools.ToolShelf.stow(i,"link"),i.label="Link",i.icon="link",i.tagName="a",i.getAttr=function(n,t,i){var f,c,l,e,a,r,u,v,y,o,s,h;if(t.type()==="Image"){if(t.a)return t.a[n]}else for(o=i.get(),c=o[0],a=o[1],l=t.content.slice(c,a),s=l.characters,r=0,v=s.length;r<v;r++)if(f=s[r],f.hasTags("a"))for(h=f.tags(),u=0,y=h.length;u<y;u++)if(e=h[u],e.name()==="a")return e.attr(n);return""},i.canApply=function(n,t){var i;return n.type()==="Image"?!0:n.content?t?t.isCollapsed()&&(i=n.content.characters[t.get()[0]],!i||!i.hasTags("a"))?!1:!0:!1:!1},i.isApplied=function(n,t){return n.type()==="Image"?n.a:i.__super__.constructor.isApplied.call(this,n,t)},i.apply=function(n,t,i){var nt,a,c,l,r,b,o,s,k,u,f,d,g,v,e,h,y,tt,p,w;if(y={tool:this,element:n,selection:t},this.dispatchEditorEvent("tool-apply",y)){if(c=!1,n.type()==="Image")f=n.domElement().getBoundingClientRect();else{if(t.isCollapsed()){for(l=n.content.characters,e=t.get(0)[0],o=e;e>0&&l[e-1].hasTags("a");)e-=1;while(o<l.length&&l[o].hasTags("a"))o+=1;t=new ContentSelect.Range(e,o);t.select(n.domElement())}n.storeState();v=new HTMLString.Tag("span",{"class":"ct--puesdo-select"});p=t.get();s=p[0];h=p[1];n.content=n.content.format(s,h,v);n.updateInnerHTML();b=n.domElement();k=b.getElementsByClassName("ct--puesdo-select");f=k[0].getBoundingClientRect()}return a=ContentTools.EditorApp.get(),u=new ContentTools.ModalUI(tt=!0,nt=!0),u.addEventListener("click",function(){return this.unmount(),r.hide(),n.content&&(n.content=n.content.unformat(s,h,v),n.updateInnerHTML(),n.restoreState()),i(c),c?ContentTools.Tools.Link.dispatchEditorEvent("tool-applied",y):void 0}),r=new ContentTools.LinkDialog(this.getAttr("href",n,t),this.getAttr("target",n,t)),w=ContentTools.getScrollPosition(),d=w[0],g=w[1],r.position([f.left+f.width/2+d,f.top+f.height/2+g]),r.addEventListener("save",function(t){var a,f,i,r,l,e,o,v,y;if(r=t.detail(),c=!0,n.type()==="Image"){if(f=["align-center","align-left","align-right"],r.href){for(n.a={href:r.href},n.a&&(n.a["class"]=n.a["class"]),r.target&&(n.a.target=r.target),e=0,v=f.length;e<v;e++)if(i=f[e],n.hasCSSClass(i)){n.removeCSSClass(i);n.a["class"]=i;break}}else{for(l=[],n.a["class"]&&(l=n.a["class"].split(" ")),o=0,y=f.length;o<y;o++)if(i=f[o],l.indexOf(i)>-1){n.addCSSClass(i);break}n.a=null}n.unmount();n.mount()}else n.content=n.content.unformat(s,h,"a"),r.href&&(a=new HTMLString.Tag("a",r),n.content=n.content.format(s,h,a),n.content.optimize()),n.updateInnerHTML();return n.taint(),u.dispatchEvent(u.createEvent("click"))}),a.attach(u),a.attach(r),u.show(),r.show()}},i}(ContentTools.Tools.Bold);ContentTools.Tools.Heading=function(t){function i(){return i.__super__.constructor.apply(this,arguments)}return n(i,t),ContentTools.ToolShelf.stow(i,"heading"),i.label="Heading",i.icon="heading",i.tagName="h1",i.canApply=function(n){return n.isFixed()?!1:n.content!==void 0&&["Text","PreText"].indexOf(n.type())!==-1},i.isApplied=function(n){return n.content?["Text","PreText"].indexOf(n.type())===-1?!1:n.tagName()===this.tagName:!1},i.apply=function(n,t,i){var e,o,r,u,f;if(f={tool:this,element:n,selection:t},this.dispatchEditorEvent("tool-apply",f))return n.storeState(),n.type()==="PreText"?(e=n.content.html().replace(/&nbsp;/g," "),u=new ContentEdit.Text(this.tagName,{},e),r=n.parent(),o=r.children.indexOf(n),r.detach(n),r.attach(u,o),n.blur(),u.focus(),u.selection(t)):(n.removeAttr("class"),n.tagName()===this.tagName?n.tagName("p"):n.tagName(this.tagName),n.restoreState()),this.dispatchEditorEvent("tool-applied",f),i(!0)},i}(ContentTools.Tool);ContentTools.Tools.Subheading=function(t){function i(){return i.__super__.constructor.apply(this,arguments)}return n(i,t),ContentTools.ToolShelf.stow(i,"subheading"),i.label="Subheading",i.icon="subheading",i.tagName="h2",i}(ContentTools.Tools.Heading);ContentTools.Tools.Paragraph=function(t){function i(){return i.__super__.constructor.apply(this,arguments)}return n(i,t),ContentTools.ToolShelf.stow(i,"paragraph"),i.label="Paragraph",i.icon="paragraph",i.tagName="p",i.canApply=function(n){return n.isFixed()?!1:n!==void 0},i.apply=function(n,t,r){var o,u,f,e;return o=this.editor().ctrlDown(),ContentTools.Tools.Heading.canApply(n)&&!o?i.__super__.constructor.apply.call(this,n,t,r):(e={tool:this,element:n,selection:t},!this.dispatchEditorEvent("tool-apply",e))?void 0:(n.parent().type()!=="Region"&&(n=n.closest(function(n){return n.parent().type()==="Region"})),f=n.parent(),u=new ContentEdit.Text("p"),f.attach(u,f.children.indexOf(n)+1),u.focus(),r(!0),this.dispatchEditorEvent("tool-applied",e))},i}(ContentTools.Tools.Heading);ContentTools.Tools.Preformatted=function(t){function i(){return i.__super__.constructor.apply(this,arguments)}return n(i,t),ContentTools.ToolShelf.stow(i,"preformatted"),i.label="Preformatted",i.icon="preformatted",i.tagName="pre",i.apply=function(n,t,i){var e,r,u,o,f;if(f={tool:this,element:n,selection:t},this.dispatchEditorEvent("tool-apply",f)){if(n.type()==="PreText"){ContentTools.Tools.Paragraph.apply(n,t,i);return}return o=n.content.text(),u=new ContentEdit.PreText("pre",{},HTMLString.String.encode(o)),r=n.parent(),e=r.children.indexOf(n),r.detach(n),r.attach(u,e),n.blur(),u.focus(),u.selection(t),i(!0),this.dispatchEditorEvent("tool-applied",f)}},i}(ContentTools.Tools.Heading);ContentTools.Tools.AlignLeft=function(t){function i(){return i.__super__.constructor.apply(this,arguments)}return n(i,t),ContentTools.ToolShelf.stow(i,"align-left"),i.label="Align left",i.icon="align-left",i.className="text-left",i.canApply=function(n){return n.content!==void 0},i.isApplied=function(n){var t;return this.canApply(n)?(((t=n.type())==="ListItemText"||t==="TableCellText")&&(n=n.parent()),n.hasCSSClass(this.className)):!1},i.apply=function(n,t,i){var f,r,e,u,o,s;if(e={tool:this,element:n,selection:t},this.dispatchEditorEvent("tool-apply",e)){for(((s=n.type())==="ListItemText"||s==="TableCellText")&&(n=n.parent()),f=[ContentTools.Tools.AlignLeft.className,ContentTools.Tools.AlignCenter.className,ContentTools.Tools.AlignRight.className],u=0,o=f.length;u<o;u++)if(r=f[u],n.hasCSSClass(r)&&(n.removeCSSClass(r),r===this.className))return i(!0);return n.addCSSClass(this.className),i(!0),this.dispatchEditorEvent("tool-applied",e)}},i}(ContentTools.Tool);ContentTools.Tools.AlignCenter=function(t){function i(){return i.__super__.constructor.apply(this,arguments)}return n(i,t),ContentTools.ToolShelf.stow(i,"align-center"),i.label="Align center",i.icon="align-center",i.className="text-center",i}(ContentTools.Tools.AlignLeft);ContentTools.Tools.AlignRight=function(t){function i(){return i.__super__.constructor.apply(this,arguments)}return n(i,t),ContentTools.ToolShelf.stow(i,"align-right"),i.label="Align right",i.icon="align-right",i.className="text-right",i}(ContentTools.Tools.AlignLeft);ContentTools.Tools.UnorderedList=function(t){function i(){return i.__super__.constructor.apply(this,arguments)}return n(i,t),ContentTools.ToolShelf.stow(i,"unordered-list"),i.label="Bullet list",i.icon="unordered-list",i.listTag="ul",i.canApply=function(n){var t;return n.isFixed()?!1:n.content!==void 0&&((t=n.parent().type())==="Region"||t==="ListItem")},i.apply=function(n,t,i){var s,r,e,u,f,o;if(o={tool:this,element:n,selection:t},this.dispatchEditorEvent("tool-apply",o))return n.parent().type()==="ListItem"?(n.storeState(),r=n.closest(function(n){return n.type()==="List"}),r.tagName(this.listTag),n.restoreState()):(u=new ContentEdit.ListItemText(n.content.copy()),e=new ContentEdit.ListItem,e.attach(u),r=new ContentEdit.List(this.listTag,{}),r.attach(e),f=n.parent(),s=f.children.indexOf(n),f.detach(n),f.attach(r,s),u.focus(),u.selection(t)),i(!0),this.dispatchEditorEvent("tool-applied",o)},i}(ContentTools.Tool);ContentTools.Tools.OrderedList=function(t){function i(){return i.__super__.constructor.apply(this,arguments)}return n(i,t),ContentTools.ToolShelf.stow(i,"ordered-list"),i.label="Numbers list",i.icon="ordered-list",i.listTag="ol",i}(ContentTools.Tools.UnorderedList);ContentTools.Tools.Table=function(t){function i(){return i.__super__.constructor.apply(this,arguments)}return n(i,t),ContentTools.ToolShelf.stow(i,"table"),i.label="Table",i.icon="table",i.canApply=function(n){return n.isFixed()?!1:n!==void 0},i.apply=function(n,t,i){var e,r,f,u,o;if(o={tool:this,element:n,selection:t},this.dispatchEditorEvent("tool-apply",o))return n.storeState&&n.storeState(),e=ContentTools.EditorApp.get(),f=new ContentTools.ModalUI,u=n.closest(function(n){return n&&n.type()==="Table"}),r=new ContentTools.TableDialog(u),r.addEventListener("cancel",function(){return function(){return f.hide(),r.hide(),n.restoreState&&n.restoreState(),i(!1)}}(this)),r.addEventListener("save",function(t){return function(e){var l,s,a,h,c;return h=e.detail(),s=!0,u?(t._updateTable(h,u),s=n.closest(function(n){return n&&n.type()==="Table"})):(u=t._createTable(h),c=t._insertAt(n),a=c[0],l=c[1],a.parent().attach(u,l),s=!1),s?n.restoreState():u.firstSection().children[0].children[0].children[0].focus(),f.hide(),r.hide(),i(!0),t.dispatchEditorEvent("tool-applied",o)}}(this)),e.attach(f),e.attach(r),f.show(),r.show()},i._adjustColumns=function(n,t){var u,h,c,l,i,e,r,o,a,s,f;for(s=n.children,f=[],o=0,a=s.length;o<a;o++)r=s[o],h=r.children[0].tagName(),l=r.children.length,i=t-l,i<0?f.push(function(){var n,t;for(t=[],e=n=i;i<=0?n<0:n>0;e=i<=0?++n:--n)u=r.children[r.children.length-1],t.push(r.detach(u));return t}()):i>0?f.push(function(){var n,t;for(t=[],e=n=0;0<=i?n<i:n>i;e=0<=i?++n:--n)u=new ContentEdit.TableCell(h),r.attach(u),c=new ContentEdit.TableCellText(""),t.push(u.attach(c));return t}()):f.push(void 0);return f},i._createTable=function(n){var i,r,u,t;return t=new ContentEdit.Table,n.head&&(u=this._createTableSection("thead","th",n.columns),t.attach(u)),i=this._createTableSection("tbody","td",n.columns),t.attach(i),n.foot&&(r=this._createTableSection("tfoot","td",n.columns),t.attach(r)),t},i._createTableSection=function(n,t,i){var u,o,s,f,e,r;for(e=new ContentEdit.TableSection(n),f=new ContentEdit.TableRow,e.attach(f),s=r=0;0<=i?r<i:r>i;s=0<=i?++r:--r)u=new ContentEdit.TableCell(t),f.attach(u),o=new ContentEdit.TableCellText(""),u.attach(o);return e},i._updateTable=function(n,t){var u,f,e,o,i,s,r;if(!n.head&&t.thead()&&t.detach(t.thead()),!n.foot&&t.tfoot()&&t.detach(t.tfoot()),u=t.firstSection().children[0].children.length,n.columns!==u)for(r=t.children,i=0,s=r.length;i<s;i++)o=r[i],this._adjustColumns(o,n.columns);return n.head&&!t.thead()&&(e=this._createTableSection("thead","th",n.columns),t.attach(e)),n.foot&&!t.tfoot()?(f=this._createTableSection("tfoot","td",n.columns),t.attach(f)):void 0},i}(ContentTools.Tool);ContentTools.Tools.Indent=function(t){function i(){return i.__super__.constructor.apply(this,arguments)}return n(i,t),ContentTools.ToolShelf.stow(i,"indent"),i.label="Indent",i.icon="indent",i.canApply=function(n){return n.parent().type()==="ListItem"&&n.parent().parent().children.indexOf(n.parent())>0},i.apply=function(n,t,i){var r;if(r={tool:this,element:n,selection:t},this.dispatchEditorEvent("tool-apply",r))return n.parent().indent(),i(!0),this.dispatchEditorEvent("tool-applied",r)},i}(ContentTools.Tool);ContentTools.Tools.Unindent=function(t){function i(){return i.__super__.constructor.apply(this,arguments)}return n(i,t),ContentTools.ToolShelf.stow(i,"unindent"),i.label="Unindent",i.icon="unindent",i.canApply=function(n){return n.parent().type()==="ListItem"},i.apply=function(n,t,i){var r;if(r={tool:this,element:n,selection:t},this.dispatchEditorEvent("tool-apply",r))return n.parent().unindent(),i(!0),this.dispatchEditorEvent("tool-applied",r)},i}(ContentTools.Tool);ContentTools.Tools.LineBreak=function(t){function i(){return i.__super__.constructor.apply(this,arguments)}return n(i,t),ContentTools.ToolShelf.stow(i,"line-break"),i.label="Line break",i.icon="line-break",i.canApply=function(n){return n.content},i.apply=function(n,t,i){var f,r,e,o,u;if(u={tool:this,element:n,selection:t},this.dispatchEditorEvent("tool-apply",u))return r=t.get()[0]+1,o=n.content.substring(0,t.get()[0]),e=n.content.substring(t.get()[1]),f=new HTMLString.String("<br>",n.content.preserveWhitespace()),n.content=o.concat(f,e),n.updateInnerHTML(),n.taint(),t.set(r,r),n.selection(t),i(!0),this.dispatchEditorEvent("tool-applied",u)},i}(ContentTools.Tool);ContentTools.Tools.Image=function(t){function i(){return i.__super__.constructor.apply(this,arguments)}return n(i,t),ContentTools.ToolShelf.stow(i,"image"),i.label="Image",i.icon="image",i.canApply=function(n){return!n.isFixed()},i.apply=function(n,t,i){var f,r,u,e;if(e={tool:this,element:n,selection:t},this.dispatchEditorEvent("tool-apply",e))return n.storeState&&n.storeState(),f=ContentTools.EditorApp.get(),u=new ContentTools.ModalUI,r=new ContentTools.ImageDialog,r.addEventListener("cancel",function(){return function(){return u.hide(),r.hide(),n.restoreState&&n.restoreState(),i(!1)}}(this)),r.addEventListener("save",function(t){return function(f){var s,h,o,c,a,v,y,l;return s=f.detail(),a=s.imageURL,c=s.imageSize,o=s.imageAttrs,o||(o={}),o.height=c[1],o.src=a,o.width=c[0],h=new ContentEdit.Image(o),l=t._insertAt(n),y=l[0],v=l[1],y.parent().attach(h,v),h.focus(),u.hide(),r.hide(),i(!0),t.dispatchEditorEvent("tool-applied",e)}}(this)),f.attach(u),f.attach(r),u.show(),r.show()},i}(ContentTools.Tool);ContentTools.Tools.Video=function(t){function i(){return i.__super__.constructor.apply(this,arguments)}return n(i,t),ContentTools.ToolShelf.stow(i,"video"),i.label="Video",i.icon="video",i.canApply=function(n){return!n.isFixed()},i.apply=function(n,t,i){var f,r,u,e;if(e={tool:this,element:n,selection:t},this.dispatchEditorEvent("tool-apply",e))return n.storeState&&n.storeState(),f=ContentTools.EditorApp.get(),u=new ContentTools.ModalUI,r=new ContentTools.VideoDialog,r.addEventListener("cancel",function(){return function(){return u.hide(),r.hide(),n.restoreState&&n.restoreState(),i(!1)}}(this)),r.addEventListener("save",function(t){return function(f){var s,l,a,o,h,c;return o=f.detail().url,o?(h=new ContentEdit.Video("iframe",{frameborder:0,height:ContentTools.DEFAULT_VIDEO_HEIGHT,src:o,width:ContentTools.DEFAULT_VIDEO_WIDTH}),c=t._insertAt(n),a=c[0],l=c[1],a.parent().attach(h,l),h.focus()):n.restoreState&&n.restoreState(),u.hide(),r.hide(),s=o!=="",i(s),s?t.dispatchEditorEvent("tool-applied",e):void 0}}(this)),f.attach(u),f.attach(r),u.show(),r.show()},i}(ContentTools.Tool);ContentTools.Tools.Undo=function(t){function i(){return i.__super__.constructor.apply(this,arguments)}return n(i,t),ContentTools.ToolShelf.stow(i,"undo"),i.label="Undo",i.icon="undo",i.requiresElement=!1,i.canApply=function(){var n;return n=ContentTools.EditorApp.get(),n.history&&n.history.canUndo()},i.apply=function(n,t){var i,u,r;if(r={tool:this,element:n,selection:t},this.dispatchEditorEvent("tool-apply",r))return i=this.editor(),i.history.stopWatching(),u=i.history.undo(),i.revertToSnapshot(u),i.history.watch(),this.dispatchEditorEvent("tool-applied",r)},i}(ContentTools.Tool);ContentTools.Tools.Redo=function(t){function i(){return i.__super__.constructor.apply(this,arguments)}return n(i,t),ContentTools.ToolShelf.stow(i,"redo"),i.label="Redo",i.icon="redo",i.requiresElement=!1,i.canApply=function(){var n;return n=ContentTools.EditorApp.get(),n.history&&n.history.canRedo()},i.apply=function(n,t){var i,u,r;if(r={tool:this,element:n,selection:t},this.dispatchEditorEvent("tool-apply",r))return i=ContentTools.EditorApp.get(),i.history.stopWatching(),u=i.history.redo(),i.revertToSnapshot(u),i.history.watch(),this.dispatchEditorEvent("tool-applied",r)},i}(ContentTools.Tool);ContentTools.Tools.Remove=function(t){function i(){return i.__super__.constructor.apply(this,arguments)}return n(i,t),ContentTools.ToolShelf.stow(i,"remove"),i.label="Remove",i.icon="remove",i.canApply=function(n){return!n.isFixed()},i.apply=function(n,t,i){var u,f,e,o,r;if(r={tool:this,element:n,selection:t},this.dispatchEditorEvent("tool-apply",r)){if(u=this.editor(),n.blur(),n.nextContent()?n.nextContent().focus():n.previousContent()&&n.previousContent().focus(),!n.isMounted()){i(!0);this.dispatchEditorEvent("tool-applied",r);return}switch(n.type()){case"ListItemText":u.ctrlDown()?(f=n.closest(function(n){return n.parent().type()==="Region"}),f.parent().detach(f)):n.parent().parent().detach(n.parent());break;case"TableCellText":u.ctrlDown()?(o=n.closest(function(n){return n.type()==="Table"}),o.parent().detach(o)):(e=n.parent().parent(),e.parent().detach(e));break;default:n.parent().detach(n)}return i(!0),this.dispatchEditorEvent("tool-applied",r)}},i}(ContentTools.Tool)}).call(this);