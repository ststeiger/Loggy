(function(){var t={}.hasOwnProperty,n=function(n,i){function u(){this.constructor=n}for(var r in i)t.call(i,r)&&(n[r]=i[r]);return u.prototype=i.prototype,n.prototype=new u,n.__super__=i.prototype,n},i=function(n,t){return function(){return n.apply(t,arguments)}};ContentTools.InspectorUI=function(t){function i(){i.__super__.constructor.call(this);this._tagUIs=[]}return n(i,t),i.prototype.mount=function(){return this._domElement=this.constructor.createDiv(["ct-widget","ct-inspector"]),this.parent().domElement().appendChild(this._domElement),this._domTags=this.constructor.createDiv(["ct-inspector__tags","ct-tags"]),this._domElement.appendChild(this._domTags),this._domCounter=this.constructor.createDiv(["ct-inspector__counter"]),this._domElement.appendChild(this._domCounter),this.updateCounter(),this._addDOMEventListeners(),this._handleFocusChange=function(n){return function(){return n.updateTags()}}(this),ContentEdit.Root.get().bind("blur",this._handleFocusChange),ContentEdit.Root.get().bind("focus",this._handleFocusChange),ContentEdit.Root.get().bind("mount",this._handleFocusChange)},i.prototype.unmount=function(){return i.__super__.unmount.call(this),this._domTags=null,ContentEdit.Root.get().unbind("blur",this._handleFocusChange),ContentEdit.Root.get().unbind("focus",this._handleFocusChange),ContentEdit.Root.get().unbind("mount",this._handleFocusChange)},i.prototype.updateCounter=function(){var i,n,t,r,f,o,h,u,e,c,s;if(this.isMounted()){for(n="",s=ContentTools.EditorApp.get().orderedRegions(),e=0,c=s.length;e<c;e++)(o=s[e],o)&&(n+=o.domElement().textContent);if(n=n.trim(),n=n.replace(/<\/?[a-z][^>]*>/gi,""),n=n.replace(/[\u200B]+/,""),n=n.replace(/['";:,.?¿\-!¡]+/g,""),u=(n.match(/\S+/g)||[]).length,u=u.toString().replace(/\B(?=(\d{3})+(?!\d))/g,","),t=ContentEdit.Root.get().focused(),!(t&&t.type()==="PreText"&&t.selection().isCollapsed())){this._domCounter.textContent=u;return}return r=0,i=1,h=t.content.substring(0,t.selection().get()[0]),f=h.text().split("\n"),r=f.length,i=f[f.length-1].length+1,r=r.toString().replace(/\B(?=(\d{3})+(?!\d))/g,","),i=i.toString().replace(/\B(?=(\d{3})+(?!\d))/g,","),this._domCounter.textContent=""+u+" / "+r+":"+i}},i.prototype.updateTags=function(){var n,t,i,r,u,o,s,f,e;for(n=ContentEdit.Root.get().focused(),f=this._tagUIs,r=0,o=f.length;r<o;r++)i=f[r],i.unmount();if(this._tagUIs=[],n){for(t=n.parents(),t.reverse(),t.push(n),e=[],u=0,s=t.length;u<s;u++)(n=t[u],ContentTools.INSPECTOR_IGNORED_ELEMENTS.indexOf(n.type())===-1)&&(n.isFixed()||(i=new ContentTools.TagUI(n),this._tagUIs.push(i),e.push(i.mount(this._domTags))));return e}},i.prototype._addDOMEventListeners=function(){return this._updateCounterInterval=setInterval(function(n){return function(){return n.updateCounter()}}(this),250)},i.prototype._removeDOMEventListeners=function(){return clearInterval(this._updateCounterInterval)},i}(ContentTools.WidgetUI);ContentTools.TagUI=function(t){function r(n){this.element=n;this._onMouseDown=i(this._onMouseDown,this);r.__super__.constructor.call(this)}return n(r,t),r.prototype.mount=function(n,t){return t==null&&(t=null),this._domElement=this.constructor.createDiv(["ct-tag"]),this._domElement.textContent=this.element.tagName(),r.__super__.mount.call(this,n,t)},r.prototype._addDOMEventListeners=function(){return this._domElement.addEventListener("mousedown",this._onMouseDown)},r.prototype._onMouseDown=function(n){var r,t,i;return n.preventDefault(),this.element.storeState&&this.element.storeState(),r=ContentTools.EditorApp.get(),i=new ContentTools.ModalUI,t=new ContentTools.PropertiesDialog(this.element),t.addEventListener("cancel",function(n){return function(){return i.hide(),t.hide(),n.element.restoreState?n.element.restoreState():void 0}}(this)),t.addEventListener("save",function(n){return function(r){var k,v,u,y,s,h,f,c,o,p,e,l,a,d,g,w,b;h=r.detail();v=h.changedAttributes;p=h.changedStyles;c=h.innerHTML;for(o in v)if(e=v[o],o==="class"){for(e===null&&(e=""),y={},w=e.split(" "),l=0,d=w.length;l<d;l++)(u=w[l],u=u.trim(),u)&&(y[u]=!0,n.element.hasCSSClass(u)||n.element.addCSSClass(u));for(b=n.element.attr("class").split(" "),a=0,g=b.length;a<g;a++)u=b[a],u=u.trim(),y[u]===void 0&&n.element.removeCSSClass(u)}else e===null?n.element.removeAttr(o):n.element.attr(o,e);for(s in p)k=p[s],k?n.element.addCSSClass(s):n.element.removeCSSClass(s);return c!==null&&c!==t.getElementInnerHTML()&&(f=n.element,f.content||(f=f.children[0]),f.content=new HTMLString.String(c,f.content.preserveWhitespace()),f.updateInnerHTML(),f.taint(),f.selection(new ContentSelect.Range(0,0)),f.storeState()),i.hide(),t.hide(),n.element.restoreState?n.element.restoreState():void 0}}(this)),r.attach(i),r.attach(t),i.show(),t.show()},r}(ContentTools.AnchoredComponentUI)}).call(this);