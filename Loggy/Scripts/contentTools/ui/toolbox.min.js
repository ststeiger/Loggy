(function(){var n=function(n,t){return function(){return n.apply(t,arguments)}},i={}.hasOwnProperty,t=function(n,t){function u(){this.constructor=n}for(var r in t)i.call(t,r)&&(n[r]=t[r]);return u.prototype=t.prototype,n.prototype=new u,n.__super__=t.prototype,n};ContentTools.ToolboxUI=function(i){function r(t){this._onStopDragging=n(this._onStopDragging,this);this._onStartDragging=n(this._onStartDragging,this);this._onDrag=n(this._onDrag,this);r.__super__.constructor.call(this);this._tools=t;this._dragging=!1;this._draggingOffset=null;this._domGrip=null;this._toolUIs={}}return t(r,i),r.prototype.isDragging=function(){return this._dragging},r.prototype.hide=function(){return this._removeDOMEventListeners(),r.__super__.hide.call(this)},r.prototype.mount=function(){var i,t,n;return this._domElement=this.constructor.createDiv(["ct-widget","ct-toolbox"]),this.parent().domElement().appendChild(this._domElement),this._domGrip=this.constructor.createDiv(["ct-toolbox__grip","ct-grip"]),this._domElement.appendChild(this._domGrip),this._domGrip.appendChild(this.constructor.createDiv(["ct-grip__bump"])),this._domGrip.appendChild(this.constructor.createDiv(["ct-grip__bump"])),this._domGrip.appendChild(this.constructor.createDiv(["ct-grip__bump"])),this._domToolGroups=this.constructor.createDiv(["ct-tool-groups"]),this._domElement.appendChild(this._domToolGroups),this.tools(this._tools),n=window.localStorage.getItem("ct-toolbox-position"),n&&/^\d+,\d+$/.test(n)&&(t=function(){var t,f,r,u;for(r=n.split(","),u=[],t=0,f=r.length;t<f;t++)i=r[t],u.push(parseInt(i));return u}(),this._domElement.style.left=""+t[0]+"px",this._domElement.style.top=""+t[1]+"px",this._contain()),this._addDOMEventListeners()},r.prototype.tools=function(n){var i,r,h,u,t,c,f,l,e,o,s;if(n===void 0)return this._tools;if(this._tools=n,this.isMounted()){e=this._toolUIs;for(t in e)c=e[t],c.unmount();for(this._toolUIs={};this._domToolGroups.lastChild;)this._domToolGroups.removeChild(this._domToolGroups.lastChild);for(o=this._tools,s=[],r=f=0,l=o.length;f<l;r=++f)u=o[r],i=this.constructor.createDiv(["ct-tool-group"]),this._domToolGroups.appendChild(i),s.push(function(){var n,f,r;for(r=[],n=0,f=u.length;n<f;n++)t=u[n],h=ContentTools.ToolShelf.fetch(t),this._toolUIs[t]=new ContentTools.ToolUI(h),this._toolUIs[t].mount(i),this._toolUIs[t].disabled(!0),r.push(this._toolUIs[t].addEventListener("applied",function(n){return function(){return n.updateTools()}}(this)));return r}.call(this));return s}},r.prototype.updateTools=function(){var n,u,t,f,i,r;n=ContentEdit.Root.get().focused();t=null;n&&n.selection&&(t=n.selection());i=this._toolUIs;r=[];for(u in i)f=i[u],r.push(f.update(n,t));return r},r.prototype.unmount=function(){return r.__super__.unmount.call(this),this._domGrip=null},r.prototype._addDOMEventListeners=function(){return this._domGrip.addEventListener("mousedown",this._onStartDragging),this._handleResize=function(n){return function(){var t;return n._resizeTimeout&&clearTimeout(n._resizeTimeout),t=function(){return n._contain()},n._resizeTimeout=setTimeout(t,250)}}(this),window.addEventListener("resize",this._handleResize),this._updateTools=function(n){return function(){var r,t,o,u,s,i,f,e;if(r=ContentTools.EditorApp.get(),i=!1,t=ContentEdit.Root.get().focused(),u=null,t===n._lastUpdateElement?t&&t.selection&&(u=t.selection(),n._lastUpdateSelection?u.eq(n._lastUpdateSelection)||(i=!0):i=!0):i=!0,r.history&&(n._lastUpdateHistoryLength!==r.history.length()&&(i=!0),n._lastUpdateHistoryLength=r.history.length(),n._lastUpdateHistoryIndex!==r.history.index()&&(i=!0),n._lastUpdateHistoryIndex=r.history.index()),n._lastUpdateElement=t,n._lastUpdateSelection=u,i){f=n._toolUIs;e=[];for(o in f)s=f[o],e.push(s.update(t,u));return e}}}(this),this._updateToolsInterval=setInterval(this._updateTools,100),this._handleKeyDown=function(){return function(n){var e,i,u,t,r,f;if(i=ContentEdit.Root.get().focused(),i&&!i.content){if(n.keyCode===46)return n.preventDefault(),ContentTools.Tools.Remove.apply(i,null,function(){});if(n.keyCode===13)return n.preventDefault(),e=ContentTools.Tools.Paragraph,e.apply(i,null,function(){})}f=navigator.appVersion;u="linux";f.indexOf("Mac")!==-1?u="mac":f.indexOf("Win")!==-1&&(u="windows");t=!1;r=!1;switch(u){case"linux":n.keyCode===90&&n.ctrlKey&&(t=n.shiftKey,r=!t);break;case"mac":n.keyCode===90&&n.metaKey&&(t=n.shiftKey,r=!t);break;case"windows":n.keyCode===89&&n.ctrlKey&&(t=!0);n.keyCode===90&&n.ctrlKey&&(r=!0)}return r&&ContentTools.Tools.Undo.canApply(null,null)&&ContentTools.Tools.Undo.apply(null,null,function(){}),t&&ContentTools.Tools.Redo.canApply(null,null)?ContentTools.Tools.Redo.apply(null,null,function(){}):void 0}}(this),window.addEventListener("keydown",this._handleKeyDown)},r.prototype._contain=function(){var n;if(this.isMounted())return n=this._domElement.getBoundingClientRect(),n.left+n.width>window.innerWidth&&(this._domElement.style.left=""+(window.innerWidth-n.width)+"px"),n.top+n.height>window.innerHeight&&(this._domElement.style.top=""+(window.innerHeight-n.height)+"px"),n.left<0&&(this._domElement.style.left="0px"),n.top<0&&(this._domElement.style.top="0px"),n=this._domElement.getBoundingClientRect(),window.localStorage.setItem("ct-toolbox-position",""+n.left+","+n.top)},r.prototype._removeDOMEventListeners=function(){return this.isMounted()&&this._domGrip.removeEventListener("mousedown",this._onStartDragging),window.removeEventListener("keydown",this._handleKeyDown),window.removeEventListener("resize",this._handleResize),clearInterval(this._updateToolsInterval)},r.prototype._onDrag=function(n){return ContentSelect.Range.unselectAll(),this._domElement.style.left=""+(n.clientX-this._draggingOffset.x)+"px",this._domElement.style.top=""+(n.clientY-this._draggingOffset.y)+"px"},r.prototype._onStartDragging=function(n){var t;if(n.preventDefault(),!this.isDragging())return this._dragging=!0,this.addCSSClass("ct-toolbox--dragging"),t=this._domElement.getBoundingClientRect(),this._draggingOffset={x:n.clientX-t.left,y:n.clientY-t.top},document.addEventListener("mousemove",this._onDrag),document.addEventListener("mouseup",this._onStopDragging),ContentEdit.addCSSClass(document.body,"ce--dragging")},r.prototype._onStopDragging=function(){if(this.isDragging())return this._contain(),document.removeEventListener("mousemove",this._onDrag),document.removeEventListener("mouseup",this._onStopDragging),this._draggingOffset=null,this._dragging=!1,this.removeCSSClass("ct-toolbox--dragging"),ContentEdit.removeCSSClass(document.body,"ce--dragging")},r}(ContentTools.WidgetUI);ContentTools.ToolUI=function(i){function r(t){this._onMouseUp=n(this._onMouseUp,this);this._onMouseLeave=n(this._onMouseLeave,this);this._onMouseDown=n(this._onMouseDown,this);this._addDOMEventListeners=n(this._addDOMEventListeners,this);r.__super__.constructor.call(this);this.tool=t;this._mouseDown=!1;this._disabled=!1}return t(r,i),r.prototype.apply=function(n,t){var r,i;if(this.tool.canApply(n,t))return i={element:n,selection:t},r=function(n){return function(t){if(t)return n.dispatchEvent(n.createEvent("applied",i))}}(this),this.dispatchEvent(this.createEvent("apply",i))?this.tool.apply(n,t,r):void 0},r.prototype.disabled=function(n){return n===void 0?this._disabled:this._disabled===n?void 0:(this._disabled=n,n?(this._mouseDown=!1,this.addCSSClass("ct-tool--disabled"),this.removeCSSClass("ct-tool--applied")):this.removeCSSClass("ct-tool--disabled"))},r.prototype.mount=function(n,t){return t==null&&(t=null),this._domElement=this.constructor.createDiv(["ct-tool","ct-tool--"+this.tool.icon]),this._domElement.setAttribute("data-ct-tooltip",ContentEdit._(this.tool.label)),r.__super__.mount.call(this,n,t)},r.prototype.update=function(n,t){if(this.tool.requiresElement&&!(n&&n.isMounted())){this.disabled(!0);return}if(this.tool.canApply(n,t))this.disabled(!1);else{this.disabled(!0);return}return this.tool.isApplied(n,t)?this.addCSSClass("ct-tool--applied"):this.removeCSSClass("ct-tool--applied")},r.prototype._addDOMEventListeners=function(){return this._domElement.addEventListener("mousedown",this._onMouseDown),this._domElement.addEventListener("mouseleave",this._onMouseLeave),this._domElement.addEventListener("mouseup",this._onMouseUp)},r.prototype._onMouseDown=function(n){if(n.preventDefault(),!this.disabled())return this._mouseDown=!0,this.addCSSClass("ct-tool--down")},r.prototype._onMouseLeave=function(){return this._mouseDown=!1,this.removeCSSClass("ct-tool--down")},r.prototype._onMouseUp=function(){var n,t;if(this._mouseDown){if(n=ContentEdit.Root.get().focused(),this.tool.requiresElement&&!(n&&n.isMounted()))return;t=null;n&&n.selection&&(t=n.selection());this.apply(n,t)}return this._mouseDown=!1,this.removeCSSClass("ct-tool--down")},r}(ContentTools.AnchoredComponentUI)}).call(this);