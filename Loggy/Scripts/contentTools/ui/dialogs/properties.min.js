(function(){var t,i,r={}.hasOwnProperty,n=function(n,t){function u(){this.constructor=n}for(var i in t)r.call(t,i)&&(n[i]=t[i]);return u.prototype=t.prototype,n.prototype=new u,n.__super__=t.prototype,n};ContentTools.PropertiesDialog=function(r){function u(n){var t;this.element=n;u.__super__.constructor.call(this,"Properties");this._attributeUIs=[];this._focusedAttributeUI=null;this._styleUIs=[];this._supportsCoding=this.element.content;((t=this.element.type())==="ListItem"||t==="TableCell")&&(this._supportsCoding=!0)}return n(u,r),u.prototype.caption=function(n){return n===void 0?this._caption:(this._caption=n,this._domCaption.textContent=ContentEdit._(n)+(": "+this.element.tagName()))},u.prototype.changedAttributes=function(){var u,f,t,n,e,i,r,h,o,s;for(f={},t={},o=this._attributeUIs,r=0,h=o.length;r<h;r++)(u=o[r],n=u.name(),i=u.value(),n!=="")&&(f[n.toLowerCase()]=!0,this.element.attr(n)!==i&&(t[n]=i));e=ContentTools.getRestrictedAtributes(this.element.tagName());s=this.element.attributes();for(n in s)(i=s[n],e&&e.indexOf(n.toLowerCase())!==-1)||f[n]===void 0&&(t[n]=null);return t},u.prototype.changedStyles=function(){var i,n,r,t,f,u;for(r={},u=this._styleUIs,t=0,f=u.length;t<f;t++)n=u[t],i=n.style.cssClass(),this.element.hasCSSClass(i)!==n.applied()&&(r[i]=n.applied());return r},u.prototype.getElementInnerHTML=function(){return this._supportsCoding?this.element.content?this.element.content.html():this.element.children[0].content.html():null},u.prototype.mount=function(){var r,f,s,t,h,n,c,l,a,v,e,o,p,w,y;for(u.__super__.mount.call(this),ContentEdit.addCSSClass(this._domElement,"ct-properties-dialog"),ContentEdit.addCSSClass(this._domView,"ct-properties-dialog__view"),this._domStyles=this.constructor.createDiv(["ct-properties-dialog__styles"]),this._domStyles.setAttribute("data-ct-empty",ContentEdit._("No styles available for this tag")),this._domView.appendChild(this._domStyles),y=ContentTools.StylePalette.styles(this.element),e=0,p=y.length;e<p;e++)l=y[e],a=new i(l,this.element.hasCSSClass(l.cssClass())),this._styleUIs.push(a),a.mount(this._domStyles);this._domAttributes=this.constructor.createDiv(["ct-properties-dialog__attributes"]);this._domView.appendChild(this._domAttributes);c=ContentTools.getRestrictedAtributes(this.element.tagName());f=this.element.attributes();r=[];for(n in f)(v=f[n],c&&c.indexOf(n.toLowerCase())!==-1)||r.push(n);for(r.sort(),o=0,w=r.length;o<w;o++)n=r[o],v=f[n],this._addAttributeUI(n,v);return this._addAttributeUI("",""),this._domCode=this.constructor.createDiv(["ct-properties-dialog__code"]),this._domView.appendChild(this._domCode),this._domInnerHTML=document.createElement("textarea"),this._domInnerHTML.setAttribute("class","ct-properties-dialog__inner-html"),this._domInnerHTML.setAttribute("name","code"),this._domInnerHTML.value=this.getElementInnerHTML(),this._domCode.appendChild(this._domInnerHTML),t=this.constructor.createDiv(["ct-control-group","ct-control-group--left"]),this._domControls.appendChild(t),this._domStylesTab=this.constructor.createDiv(["ct-control","ct-control--icon","ct-control--styles"]),this._domStylesTab.setAttribute("data-ct-tooltip",ContentEdit._("Styles")),t.appendChild(this._domStylesTab),this._domAttributesTab=this.constructor.createDiv(["ct-control","ct-control--icon","ct-control--attributes"]),this._domAttributesTab.setAttribute("data-ct-tooltip",ContentEdit._("Attributes")),t.appendChild(this._domAttributesTab),this._domCodeTab=this.constructor.createDiv(["ct-control","ct-control--icon","ct-control--code"]),this._domCodeTab.setAttribute("data-ct-tooltip",ContentEdit._("Code")),t.appendChild(this._domCodeTab),this._supportsCoding||ContentEdit.addCSSClass(this._domCodeTab,"ct-control--muted"),this._domRemoveAttribute=this.constructor.createDiv(["ct-control","ct-control--icon","ct-control--remove","ct-control--muted"]),this._domRemoveAttribute.setAttribute("data-ct-tooltip",ContentEdit._("Remove")),t.appendChild(this._domRemoveAttribute),s=this.constructor.createDiv(["ct-control-group","ct-control-group--right"]),this._domControls.appendChild(s),this._domApply=this.constructor.createDiv(["ct-control","ct-control--text","ct-control--apply"]),this._domApply.textContent=ContentEdit._("Apply"),s.appendChild(this._domApply),h=window.localStorage.getItem("ct-properties-dialog-tab"),h==="attributes"?(ContentEdit.addCSSClass(this._domElement,"ct-properties-dialog--attributes"),ContentEdit.addCSSClass(this._domAttributesTab,"ct-control--active")):h==="code"&&this._supportsCoding?(ContentEdit.addCSSClass(this._domElement,"ct-properties-dialog--code"),ContentEdit.addCSSClass(this._domCodeTab,"ct-control--active")):(ContentEdit.addCSSClass(this._domElement,"ct-properties-dialog--styles"),ContentEdit.addCSSClass(this._domStylesTab,"ct-control--active")),this._addDOMEventListeners()},u.prototype.save=function(){var t,n;return n=null,this._supportsCoding&&(n=this._domInnerHTML.value),t={changedAttributes:this.changedAttributes(),changedStyles:this.changedStyles(),innerHTML:n},this.dispatchEvent(this.createEvent("save",t))},u.prototype._addAttributeUI=function(n,i){var u,r;return r=this,u=new t(n,i),this._attributeUIs.push(u),u.addEventListener("blur",function(){var t,n,i;return r._focusedAttributeUI=null,ContentEdit.addCSSClass(r._domRemoveAttribute,"ct-control--muted"),t=r._attributeUIs.indexOf(this),i=r._attributeUIs.length,this.name()===""&&t<i-1&&(this.unmount(),r._attributeUIs.splice(t,1)),n=r._attributeUIs[i-1],n&&n.name()&&n.value()?r._addAttributeUI("",""):void 0}),u.addEventListener("focus",function(){return r._focusedAttributeUI=this,ContentEdit.removeCSSClass(r._domRemoveAttribute,"ct-control--muted")}),u.addEventListener("namechange",function(){var o,u,f,t,i,s,e;for(o=r.element,n=this.name().toLowerCase(),f=ContentTools.getRestrictedAtributes(o.tagName()),t=!0,f&&f.indexOf(n)!==-1&&(t=!1),e=r._attributeUIs,i=0,s=e.length;i<s;i++)(u=e[i],n!=="")&&u!==this&&u.name().toLowerCase()===n&&(t=!1);return this.valid(t),t?ContentEdit.removeCSSClass(r._domApply,"ct-control--muted"):ContentEdit.addCSSClass(r._domApply,"ct-control--muted")}),u.mount(this._domAttributes),u},u.prototype._addDOMEventListeners=function(){var n,t;return u.__super__._addDOMEventListeners.call(this),n=function(n){return function(t){var f,i,e,u,r,o;for(u=["attributes","code","styles"],r=0,o=u.length;r<o;r++)(i=u[r],i!==t)&&(e=i.charAt(0).toUpperCase()+i.slice(1),ContentEdit.removeCSSClass(n._domElement,"ct-properties-dialog--"+i),ContentEdit.removeCSSClass(n["_dom"+e+"Tab"],"ct-control--active"));return f=t.charAt(0).toUpperCase()+t.slice(1),ContentEdit.addCSSClass(n._domElement,"ct-properties-dialog--"+t),ContentEdit.addCSSClass(n["_dom"+f+"Tab"],"ct-control--active"),window.localStorage.setItem("ct-properties-dialog-tab",t)}}(this),this._domStylesTab.addEventListener("mousedown",function(){return function(){return n("styles")}}(this)),this._domAttributesTab.addEventListener("mousedown",function(){return function(){return n("attributes")}}(this)),this._supportsCoding&&this._domCodeTab.addEventListener("mousedown",function(){return function(){return n("code")}}(this)),this._domRemoveAttribute.addEventListener("mousedown",function(n){return function(t){var i,r;return t.preventDefault(),n._focusedAttributeUI&&(i=n._attributeUIs.indexOf(n._focusedAttributeUI),r=i===n._attributeUIs.length-1,n._focusedAttributeUI.unmount(),n._attributeUIs.splice(i,1),r)?n._addAttributeUI("",""):void 0}}(this)),t=function(n){return function(){var t;try{return t=new HTMLString.String(n._domInnerHTML.value),ContentEdit.removeCSSClass(n._domInnerHTML,"ct-properties-dialog__inner-html--invalid"),ContentEdit.removeCSSClass(n._domApply,"ct-control--muted")}catch(i){return ContentEdit.addCSSClass(n._domInnerHTML,"ct-properties-dialog__inner-html--invalid"),ContentEdit.addCSSClass(n._domApply,"ct-control--muted")}}}(this),this._domInnerHTML.addEventListener("input",t),this._domInnerHTML.addEventListener("propertychange",t),this._domApply.addEventListener("click",function(n){return function(t){var i;return t.preventDefault(),i=n._domApply.getAttribute("class"),i.indexOf("ct-control--muted")===-1?n.save():void 0}}(this))},u}(ContentTools.DialogUI);i=function(t){function i(n,t){this.style=n;i.__super__.constructor.call(this);this._applied=t}return n(i,t),i.prototype.applied=function(n){return n===void 0?this._applied:this._applied===n?void 0:(this._applied=n,this._applied?ContentEdit.addCSSClass(this._domElement,"ct-section--applied"):ContentEdit.removeCSSClass(this._domElement,"ct-section--applied"))},i.prototype.mount=function(n,t){var r;return t==null&&(t=null),this._domElement=this.constructor.createDiv(["ct-section"]),this._applied&&ContentEdit.addCSSClass(this._domElement,"ct-section--applied"),r=this.constructor.createDiv(["ct-section__label"]),r.textContent=this.style.name(),this._domElement.appendChild(r),this._domElement.appendChild(this.constructor.createDiv(["ct-section__switch"])),i.__super__.mount.call(this,n,t)},i.prototype._addDOMEventListeners=function(){var n;return n=function(n){return function(t){return t.preventDefault(),n.applied()?n.applied(!1):n.applied(!0)}}(this),this._domElement.addEventListener("click",n)},i}(ContentTools.AnchoredComponentUI);t=function(t){function i(n,t){i.__super__.constructor.call(this);this._initialName=n;this._initialValue=t}return n(i,t),i.prototype.name=function(){return this._domName.value.trim()},i.prototype.value=function(){return this._domValue.value.trim()},i.prototype.mount=function(n,t){return t==null&&(t=null),this._domElement=this.constructor.createDiv(["ct-attribute"]),this._domName=document.createElement("input"),this._domName.setAttribute("class","ct-attribute__name"),this._domName.setAttribute("name","name"),this._domName.setAttribute("placeholder",ContentEdit._("Name")),this._domName.setAttribute("type","text"),this._domName.setAttribute("value",this._initialName),this._domElement.appendChild(this._domName),this._domValue=document.createElement("input"),this._domValue.setAttribute("class","ct-attribute__value"),this._domValue.setAttribute("name","value"),this._domValue.setAttribute("placeholder",ContentEdit._("Value")),this._domValue.setAttribute("type","text"),this._domValue.setAttribute("value",this._initialValue),this._domElement.appendChild(this._domValue),i.__super__.mount.call(this,n,t)},i.prototype.valid=function(n){return n?ContentEdit.removeCSSClass(this._domName,"ct-attribute__name--invalid"):ContentEdit.addCSSClass(this._domName,"ct-attribute__name--invalid")},i.prototype._addDOMEventListeners=function(){return this._domName.addEventListener("blur",function(n){return function(){var i,t,r;return i=n.name(),t=n._domElement.nextSibling,n.dispatchEvent(n.createEvent("blur")),i===""&&t?(r=t.querySelector(".ct-attribute__name"),r.focus()):void 0}}(this)),this._domName.addEventListener("focus",function(n){return function(){return n.dispatchEvent(n.createEvent("focus"))}}(this)),this._domName.addEventListener("input",function(n){return function(){return n.dispatchEvent(n.createEvent("namechange"))}}(this)),this._domName.addEventListener("keydown",function(n){return function(t){if(t.keyCode===13)return n._domValue.focus()}}(this)),this._domValue.addEventListener("blur",function(n){return function(){return n.dispatchEvent(n.createEvent("blur"))}}(this)),this._domValue.addEventListener("focus",function(n){return function(){return n.dispatchEvent(n.createEvent("focus"))}}(this)),this._domValue.addEventListener("keydown",function(n){return function(t){var i,r;if(t.keyCode===13||t.keyCode===9&&!t.shiftKey)return t.preventDefault(),i=n._domElement.nextSibling,i||(n._domValue.blur(),i=n._domElement.nextSibling),i?(r=i.querySelector(".ct-attribute__name"),r.focus()):void 0}}(this))},i}(ContentTools.AnchoredComponentUI)}).call(this);